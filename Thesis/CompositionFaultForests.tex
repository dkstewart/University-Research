\chapter{Composition of Fault Forests}
\label{chap:compFF}
Proving that the system operates within some level of safety when failures are present is an important aspect of critical systems development and falls under the discipline of safety analysis. Safety analysis produces various safety related artifacts that are used during development and certification of critical systems~\cite{SAE:ARP4754A}. Examples include {\em minimal cut sets} -- each set represents the minimal set of faults that must all occur in order to violate a safety property and {\em fault trees} -- the evaluation that determines all credible failure combinations which could cause an undesired top level hazard event. The fault tree can be transformed to an equivalent Boolean formula whose literals appear in the minimal cut sets. Since the introduction of minimal cut sets in the field of safety analysis, much research has been performed to address the generation of these sets and associated formulae~\cite{vesely1981fault,fta:survey,historyFTA}. As critical systems get larger, more minimal cut sets are possible with increasing cardinality. In recent years, symbolic model checking has been used to address scaling the analysis of systems with millions of minimal cut sets~\cite{bieber2002combination,schafer2003combining,symbFTA}. 

The state space explosion is a challenge when performing formal verification on industrial sized systems. Compositional reasoning takes advantage of the hierarchical organizaton of a system model as verification is performed. A compositional approach verifies each layer of the system hierarchy in isolation and allows global properties to be inferred about the entire system~\cite{berezin1997compositional}. The {\em assume-guarantee} paradigm is commonly used in compositional reasoning. If the assumed behavior of the components is true, then the guarantee will hold~\cite{NFM2012:CoGaMiWhLaLu}.

In Chapter~\ref{chap:faultModeling}, we described how to perform behavioral fault analysis using the safety annex. This approach allows for either monolithic or compositional analysis. In monolithic analysis, the model is flattened and all component contracts are used in the proof of a safety property. Any failures that occur at the leaf level will be reflected at the top of the system hierarchy. In compositional fault analysis, this is not the case. Compositional analysis is performed from the top down and progresses per layer of the system architecture. An active fault at a leaf level may violate guarantees at its parent level and this will be seen in the fault analysis for that layer. But if that parent level guarantee is necessary for proving a safety property of the system, no indication of this can be shown. We wish to reflect errors in leaf level components at the top of the hierarchy in a compositional manner. 

Using an assume-guarantee reasoning framework, we extend the definition of the nomimal transition system to allow for the possibility of unconstrained output corresponding to violated guarantees. We use this idea to reason about all possible violations of a safety property per layer of analysis and then compose the results. The formalization defines a sound approach to the composition of the Boolean formulae that describe component fault trees.

After we provide the formalization, we describe the implementation in the OSATE tool for the Architecture and Analysis and Design Lanugage (AADL)~\cite{FeilerModelBasedEngineering2012}. AADL has two annexes that are of interest to us: the Assume-Guarantee Reasoning Environment (AGREE)~\cite{NFM2012:CoGaMiWhLaLu} and the safety annex~\cite{stewart2020safety}. AGREE provides the assume-guarantee reasoning required fornominal model analysis, and the safety annex allows us to define faults on component outputs. For the implementation of this compositional approach, we look to recent work in formal verification. Ghassabani et al.~developed an algorithm that traces a safety property to a minimal set of model elements necessary for proof; this is called the \textit{all minimal inductive validity core} algorithm (\aivcalg)~\cite{GhassabaniGW16,Ghassabani2017EfficientGO}. Inductive validity cores produce the minimal sets of model elements necessary to prove a property. Each set contains the behavioral contracts -- the assumptions and guarantees of components -- used in a proof. We collect all MIVCs per layer to generate the minimal cut sets and thus the fault trees to be composed.


This chapter presents a compositional approach to generating fault forests (sets of fault trees) and associated minimal cut sets, allowing us to reason uniformly about faults in hardware and software and their impact on system properties. 

\input{runningexampleFF}
\input{formalizationFF}
\input{preliminariesFF}
\input{implBackgroundFF}
\input{implementationFF}
\input{futureworkFF}